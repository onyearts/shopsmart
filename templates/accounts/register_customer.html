{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div id="register-message"></div>
<form method="post" class="registration-form px-4 py-5">
  {% csrf_token %}
  <h2 class="text-center mb-4">Create Customer Account</h2>

  <!-- Error container -->
  {% if error %}
    <div id="error-container" class="alert alert-danger mb-4">
        {{ error }}
    </div>
  {% endif %}


  <!-- User Fields -->
  <div class="mb-3">
    {{ user_form.username.label_tag }}
    {{ user_form.username }}
    {% if user_form.username.errors %}
      <div class="invalid-feedback d-block">{{ user_form.username.errors.0 }}</div>
    {% endif %}
  </div>

  <div class="mb-3">
    {{ user_form.email.label_tag }}
    {{ user_form.email }}
    {% if user_form.email.errors %}
      <div class="invalid-feedback d-block">{{ user_form.email.errors.0 }}</div>
    {% endif %}
  </div>

  <div class="mb-3 row g-2">
    <div class="col-md-6 position-relative">
      {{ user_form.password1.label_tag }}
      <div class="input-group">
        {{ user_form.password1|attr:"type:password" }}
        <button type="button" class="btn btn-outline-secondary toggle-password" tabindex="-1">
          <i class="bi bi-eye-slash"></i>
        </button>
      </div>
      {% if user_form.password1.errors %}
        <div class="invalid-feedback d-block">{{ user_form.password1.errors.0 }}</div>
      {% endif %}
    </div>

    <div class="col-md-6 position-relative">
      {{ user_form.password2.label_tag }}
      <div class="input-group">
        {{ user_form.password2|attr:"type:password" }}
        <button type="button" class="btn btn-outline-secondary toggle-password" tabindex="-1">
          <i class="bi bi-eye-slash"></i>
        </button>
      </div>
      {% if user_form.password2.errors %}
        <div class="invalid-feedback d-block">{{ user_form.password2.errors.0 }}</div>
      {% endif %}
    </div>
  </div>

  <!-- Customer Profile Fields -->
  <div class="mb-3">
    <label for="id_phone">Phone Number</label>
    <input type="text" name="phone" maxlength="10" class="form-control" 
           pattern="\d{10}" title="Please enter exactly 10 digits" 
           required id="id_phone">
    <small class="text-muted">10 digits only (no spaces or special characters)</small>
    <div id="phone-error" class="invalid-feedback" style="display: none;"></div>
  </div>

  <div class="mb-3">
    {{ profile_form.preferred_location.label_tag }}
    {{ profile_form.preferred_location }}
    {% if profile_form.preferred_location.errors %}
      <div class="invalid-feedback d-block">{{ profile_form.preferred_location.errors.0 }}</div>
    {% endif %}
  </div>

  <button type="submit" class="btn btn-primary btn-lg w-100 mt-3">
    <i class="bi bi-person-plus me-2"></i> Create Account
  </button>

  <div class="social-login mt-4">
    <div class="divider d-flex align-items-center my-4">
        <span class="text-muted mx-2">or sign up with</span>
    </div>
    <div class="d-flex justify-content-center gap-3">
        <button type="button" class="btn btn-outline-danger rounded-pill px-4">
            <i class="bi bi-google me-2"></i> Google
        </button>
        <button type="button" class="btn btn-outline-primary rounded-pill px-4">
            <i class="bi bi-facebook me-2"></i> Facebook
        </button>
    </div>
  </div>

  <div class="registration-footer text-center mt-4">
      <p class="text-muted">Already have an account? <a href="{% url 'accounts:login' %}" class="text-decoration-none">Sign in</a></p>
  </div>

  <div class="text-center mt-3">
    <p class="text-muted">Are you a shop owner? <a href="{% url 'accounts:register_shop_owner' %}">Register here</a></p>
  </div>

</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function() {
            const input = this.closest('.input-group').querySelector('input');
            const icon = this.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.replace('bi-eye-slash', 'bi-eye');
            } else {
                input.type = 'password';
                icon.classList.replace('bi-eye', 'bi-eye-slash');
            }
        });
    });
});
</script>

{% endblock %}